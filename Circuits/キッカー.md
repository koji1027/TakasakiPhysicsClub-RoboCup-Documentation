## ソレノイド
### 概要
キッカーではソレノイドを使用します。ソレノイドとは電気エネルギーを運動エネルギーに変換するアクチュエータの一種です。モーターが回転運動を実現するのに大して、ソレノイドは直線運動を実現してくれます。キックには最適というわけです。

## 構造・原理
![img](https://www.takaha.co.jp/technological/img/action/img_01.gif)
- 可動鉄心
	- 直線的に動く部分
	- 一番重要
- フレーム
	- ただの枠
- 銅線
	- コイル
	- ここに電流を流して磁場を発生させる
- 固定鉄心
	- 可動鉄心が吸引される場所

1. コイルに電流を流す。
	- 磁場が発生する
2. **可動鉄心が吸引される**
	- 固定鉄心に可動鉄心が吸引される
	- 磁場による
3. コイルに電流を流すのをやめる
	- 磁場の発生が終わる
4. **可動鉄心が伸びる**
	- 内部にあるバネによる

以上がソレノイドの伸び縮みの一連の流れです。キックもこの単純な動作で実現します。

ソレノイドを選定する際にはストローク長に注意する必要があります。10cmぐらいのものを使っておけば大丈夫です。
## キック回路
原理のところでわかるようにコイルに流れる電流をOn/Offして上げるだけで済みます。しかし、ソレノイドには大きな電圧をかけ、そこそこ大きな電流を流す必要があるのでマイコンから直接On/Offすることはできません。

ソレノイドを使ったキックの力は主に**ソレノイドの抵抗値**、**電圧**、**通電率**に依存します。（もちろんソレノイド自身の性能にも依存しますがこの資料ではそこは取り扱いません。）本来であればボールの質量や飛ばしたい距離などからソレノイドの出力を求める必要があります。ただ、ロボカップサッカーのキッカーほどでわざわざ物理計算をする必要がないのでここでは割愛します。ロボカップサッカーではキッカーの威力に制限がありますが、キッカーの威力を測定する装置で測定すればよいので、色々な電圧や通電率で試してみるのが良いと思います。

![ima|335](https://takaha.co.jp/product/cb/img/item/cb1037_image_02_l.gif)
この画像は[タカハのソレノイドCB1037](https://www.takaha-shop.com/SHOP/cb1037.html)の仕様定格表です。
```cardlink
url: https://www.takaha-shop.com/SHOP/cb1037.html
title: "CB1037 ソレノイドショップ　タカハ"
description: "*プッシュ式ソレノイド(戻りバネ・ストッパー付）*可動鉄心（プランジャー）サイズφ10*フレーム全長36.7mm*製品重量105g*吸引力、通電時間等はカタログ中の吸引力グラフをご覧下さい。【       ～ 10台】　　即出荷【11 ～ 30台】　　5営業日内出荷【31台 ～       】        納期ご連絡"
host: www.takaha-shop.com
```
これを見ると最低でもDC6Vが想定されていますね。何が言いたいかと言うとキッカーにはかなりの電圧が必要ということです。現状のロボカップサッカーでは昇圧したときの電圧制限はなかったと思うので、やればやるほど強くなります。ただ、先述の通りキッカーの威力に制限があるので注意が必要です。私のときには40Vまで昇圧していました。

### 昇圧回路
自作でも既製品を使用するのでも構いません。私は後者をおすすめします。私のときには40Vまで昇圧できる昇圧回路を使用しましたが、めちゃくちゃ壊れたのでおすすめしません。（設計の問題だと思うけど）パワー電源を扱う回路の開発は使わないものに比べて遥かに大変なのでおすすめしません。この資料で昇圧回路の作り方については触れません。（電源についての資料で触れるかも）

以下にいくつかおすすめの昇圧回路モジュールを紹介します。

### スイッチング回路
昇圧した電源をソレノイドにつなぐためのスイッチング回路について解説します。こちらは自作が必要になると思います。電圧が低いマイコンから高電圧電源をスイッチングするのでやることはモータードライバと大きく変わりません。つまり、MOSFETを使うことになります。

MOSFETを使ったスイッチには**ハイサイドスイッチ**と**ローサイドスイッチ**の2つがあります。それぞれにメリット・デメリットがあるので回路構成とともに解説します。![img|214](https://analogista.jp/wp-content/uploads/2021/05/hssw03.jpg)
### ハイサイドスイッチ
名前の通りハイサイド（電源と負荷（今回の場合はソレノイド）の間）側をMOSFETによってスイッチングするものになります。以下が主な特徴です。

- 長所
	- グラウンド側との接続が遮断されない
		- 回路全体が浮いた状態にならない
	- スイッチの先でショートした場合に電源を遮断できる
		- ショート検知用の電流センサが別途必要
	- 比較的安全
		- 回路から電源を遮断することでOffしているので、Off時に危険な動作をする可能性が比較的低い
- 短所
	- Pch MOSFETを使用する必要がある
		- 高価、入手性が悪い

#### 使い方と注意
負荷側の電源（これ以降はパワー電源と呼ぶ）電圧がマイコンの電源（これ以降はロジック電源と呼ぶ電圧よりも高いときには、**マイコンのGPIOで直接スイッチングする際に注意が必要です。**（パワー電源電圧がロジック電源電圧よりも低いことなんて基本無いです。![[highsideswitch.jpg|357]]
理由は回路図を見れば明らかです。（VDDはパワー電源です。）MOSFETのゲートはプルアップされているので、**入力がハイインピーダンス（※1）の時には**$$V_{gs} = 0 > V_{th}$$となるのでMOSFETはOff状態になります。（※2）
	※1：信号線がいずれの電源やグラウンドに対しても非常に高いインピーダンスとなっている状態。インピーダンスとは交流回路における抵抗。今回の場合はいわゆる抵抗だと思ってくれれば良い。ハイインピーダンスにおける各電源、グラウンドとの間の抵抗は極めて大きく、接続されていない状態とみなすことができる。100kΩとかそういう次元ではなくもっと大きい。
	※2：**Pch MOSFET**を使用しているので回路図上の上側がSource、下側がDrainとなっています。また、$V_{th} < 0$となっています。
MOSFETをOnにするにはINPUTをLowにして、
$$V_{gs} = -VDD < V_{th}$$としてやれば良いわけです。

先ほど、注意が必要と述べましたがなぜか考えていきます。MOSFETをOnにするにはINPUTをハイインピーダンスにする必要がありました。なぜ、Highではだめなのでしょうか？マイコンのGPIOとINPUTが接続されいてる前、INPUTピンはプルアップされているので $V_{INPUT} = V_g = V_E$ となっています。ここに、マイコンのGPIOをHighの状態で接続すると、マイコンのピンに電圧$V_E$がかかることになります。基本的にマイコンのGPIOの耐圧は5V程度です。基本的に$V_E > 5$であるのでパワー電源がマイコンに流れ込み、マイコンが壊れます。一方、Lowの状態であればマイコンにパワー電源が流れ込むこと無くグラウンド側に逃げてくれるので壊れることはありません。
### ローサイドスイッチ
名前の通りローサイド（負荷（今回の場合はソレノイド）とグラウンドの間）側をMOSFETによってスイッチングするものになります。以下が主な特徴です。

- 長所
	- Nch MOSFETが使える
		- 安価、入手性が良い
- 短所
	- Off時に回路が浮いた状態になる
		- 回路とグラウンドを切り離しているため
		- Off時に回路上の電位が定まらないので**他の回路と接続してはならない**
			- 独立した回路として運用するなら問題ない
	- スイッチングのために負荷に接続する電源より高電圧な電源を用意する必要がある
		- Nch MOSFETをOnにするには $$V_{gs} \geq Vth$$ が必要であるが、On時には $$V_s = V_E \quad V_E：負荷につなぐ電源電圧$$であるので、$$V_g \geq V_s + V_{th} = V_E + V_{th}$$が必要になるため。
### キッカーの設計