著者：根岸孝次

自立型ロボットにおいて最重要な姿勢制御の基本的事項について解説します。

## 姿勢制御について

自立型ロボットにおける姿勢制御は、ロボットが安定して動作するために重要な要素です。姿勢制御とは、ロボットの傾きや向きを検出し、それを目標の状態に保つための制御を行うことを指します。ここでは、IMU（Inertial Measurement Unit）から得られる角速度などの情報を利用して、ロボットの姿勢を制御する一連の流れについて解説します。

### 姿勢制御の目的と意義

姿勢制御の主な目的は、ロボットが傾いたり転倒したりしないように、安定した状態を維持することです。例えば、二足歩行ロボットやドローンなどは、姿勢制御がなければバランスを保つことができません。姿勢制御を行うことで、ロボットは外部からの力や環境の変化に対応し、安定した動作を実現できます。

### 姿勢制御の流れ

姿勢制御は以下のような流れで行われます。

1. **センサーからのデータ取得**: IMUから角速度や加速度などのデータを取得します。
2. **角度の算出**: 取得したデータからロボットの現在の角度を計算します。
3. **制御信号の生成**: 目標の角度と現在の角度の差を計算し、それを基に制御信号を生成します。
4. **アクチュエータへの指令**: 生成した制御信号をモーターなどのアクチュエータに送り、ロボットの姿勢を調整します。

### オイラー角とクォータニオン

姿勢を表現する方法として、オイラー角とクォータニオンがあります。それぞれの特徴を以下に示します。

#### オイラー角

オイラー角は、3つの軸（通常はロール、ピッチ、ヨー）の回転角度で姿勢を表現する方法です。直感的で理解しやすいという利点がありますが、ジンバルロックという問題が発生することがあります。ジンバルロックとは、特定の角度で自由度が失われる現象です。

オイラー角の回転行列は以下のように表されます。

$$
R = R_z(\psi) R_y(\theta) R_x(\phi)
$$

ここで、$\psi$、$\theta$、$\phi$ はそれぞれヨー、ピッチ、ロール角です。

##### オイラー角の詳細

オイラー角は、3つの軸に対する回転角度を順番に適用することで、物体の姿勢を表現します。具体的には、以下の3つの回転を行います。

1. **ロール角（Roll, $\phi$）**: X軸周りの回転。物体の左右の傾きを表します。
2. **ピッチ角（Pitch, $\theta$）**: Y軸周りの回転。物体の前後の傾きを表します。
3. **ヨー角（Yaw, $\psi$）**: Z軸周りの回転。物体の左右の向きを表します。

これらの回転を順番に適用することで、物体の姿勢を一意に決定します。例えば、ロボットの姿勢を表現する場合、まずZ軸周りにヨー角で回転し、次にY軸周りにピッチ角で回転し、最後にX軸周りにロール角で回転します。

##### ジンバルロック

ジンバルロックは、オイラー角を使用する際に発生する問題です。具体的には、ピッチ角が90度（または-90度）に近づくと、ロール角とヨー角の区別がつかなくなり、自由度が失われます。この現象は、特に航空機やロボットの姿勢制御において問題となります。



### ピッチ角の姿勢制御

今回の資料では、オイラー角を採用し、特にピッチ角についての姿勢制御を行います。ピッチ角は、ロボットの前後の傾きを表す角度です。IMUから得られた角速度データを積分することで、現在のピッチ角を算出し、目標のピッチ角との差を基に制御信号を生成します。

ピッチ角の制御には、PID制御がよく用いられます。PID制御は、比例（P）、積分（I）、微分（D）の3つの要素を組み合わせて、目標値との誤差を最小化する制御方法です。

$$
u(t) = K_p e(t) + K_i \int_0^t e(t^{\prime}) dt^{\prime} + K_d \frac{de(t)}{dt}
$$

ここで、$u(t)$ は制御信号(Duty比など)、$e(t)$ は誤差、$K_p$、$K_i$、$K_d$ はそれぞれ比例、積分、微分ゲインです。

### まとめ

姿勢制御は、自立型ロボットが安定して動作するために不可欠な技術です。IMUから得られるデータを基に、オイラー角やクォータニオンを用いて姿勢を計算し、PID制御などを利用して目標の姿勢に制御します。特にピッチ角の制御は、ロボットの前後のバランスを保つために重要です。これらの技術を理解し、適切に実装することで、ロボットの安定性と性能を向上させることができます。

## PID制御

## サンプルプログラム

## 誤差の補正